# LED风险管理系统使用流程图

## 系统整体流程图

```mermaid
graph TD
    A[访问系统] --> B{是否已注册?}
    B -->|否| C[用户注册申请]
    B -->|是| D[登录系统]
    
    C --> E[管理员审批]
    E --> F{审批结果}
    F -->|批准| G[创建用户账户]
    F -->|拒绝| H[申请被拒绝]
    G --> D
    H --> I[重新申请或联系管理员]
    
    D --> J{用户角色}
    J -->|Inputter| K[录入员功能]
    J -->|Approver| L[审批员功能]
    J -->|Administrator| M[管理员功能]
    
    K --> N[创建事件]
    L --> O[审批事件]
    M --> P[用户管理]
    
    N --> Q[事件提交L1审批]
    O --> R[审批决策]
    P --> S[管理用户申请]
    
    Q --> T{审批结果}
    T -->|批准| U[事件完成]
    T -->|拒绝| V[事件被拒绝]
    
    R --> W[更新事件状态]
    S --> X[批准/拒绝用户申请]
```

## 用户注册流程

```mermaid
sequenceDiagram
    participant U as 新用户
    participant S as 系统
    participant A as 管理员
    
    U->>S: 访问注册页面
    S->>U: 显示注册表单
    U->>S: 填写个人信息
    U->>S: 选择申请角色
    U->>S: 提交申请
    S->>S: 保存申请记录
    S->>U: 显示申请成功消息
    
    Note over A: 管理员登录系统
    A->>S: 访问用户管理页面
    S->>A: 显示待审批申请列表
    A->>S: 查看申请详情
    S->>A: 显示申请信息
    
    A->>S: 选择批准/拒绝
    alt 批准申请
        S->>S: 创建新用户账户
        S->>A: 更新申请状态为已批准
    else 拒绝申请
        S->>A: 更新申请状态为已拒绝
    end
    
    S->>U: 用户可查看申请状态
```

## 事件管理流程

```mermaid
sequenceDiagram
    participant I as Inputter
    participant S as 系统
    participant AP as Approver
    participant AD as Administrator
    
    I->>S: 登录系统
    I->>S: 创建新事件
    S->>I: 显示事件表单
    I->>S: 填写事件信息
    I->>S: 提交事件
    S->>S: 自动设置为L1审批状态
    S->>I: 显示提交成功消息
    
    Note over AP: 审批员登录系统
    AP->>S: 查看待审批事件
    S->>AP: 显示L1待审批事件列表
    AP->>S: 查看事件详情
    S->>AP: 显示完整事件信息
    
    AP->>S: 选择批准/拒绝
    alt 批准事件
        S->>S: 更新事件状态为已批准
        S->>AP: 显示审批成功
    else 拒绝事件
        S->>S: 更新事件状态为已拒绝
        S->>AP: 显示拒绝成功
    end
    
    Note over AD: 管理员可查看所有事件
    AD->>S: 访问事件列表
    S->>AD: 显示所有事件
    AD->>S: 可编辑/删除事件
```

## 审批流程详细说明

### L1审批流程
1. **Inputter创建事件**
   - 填写事件基本信息
   - 系统自动设置为"Pending Approval L1"状态
   - 事件提交到L1审批队列

2. **Approver审批**
   - 查看L1待审批事件列表
   - 点击查看事件详情
   - 选择批准或拒绝
   - 系统更新事件状态

3. **审批结果**
   - 批准：事件状态变为"Approved"
   - 拒绝：事件状态变为"Rejected"
   - 事件可在事件列表中查看

### 用户权限说明

#### Inputter (录入员)
- ✅ 创建新事件
- ✅ 编辑自己创建的事件
- ✅ 查看自己部门的事件
- ✅ 删除草稿状态的事件
- ❌ 审批事件
- ❌ 管理用户

#### Approver (审批员)
- ✅ 审批L1级别事件
- ✅ 查看自己部门的事件
- ✅ 管理IAM项目
- ❌ 创建事件
- ❌ 管理用户

#### Administrator (管理员)
- ✅ 查看所有事件
- ✅ 编辑任何事件
- ✅ 删除任何事件
- ✅ 审批所有级别申请
- ✅ 管理用户注册申请
- ✅ 管理所有用户
- ✅ 访问数据管理功能

## 数据流程

```mermaid
graph LR
    A[用户操作] --> B[localStorage]
    B --> C[数据持久化]
    C --> D[页面刷新后保持]
    D --> E[数据导出]
    E --> F[JSON文件]
    F --> G[数据导入]
    G --> B
```

## 系统状态说明

### 事件状态
- **Draft**: 草稿状态（可编辑）
- **Pending Approval L1**: 等待L1审批
- **Pending Approval L2**: 等待L2审批（预留）
- **Approved**: 已批准
- **Rejected**: 已拒绝

### 用户申请状态
- **Pending**: 待审批
- **Approved**: 已批准
- **Rejected**: 已拒绝

### 用户状态
- **Active**: 活跃用户
- **Inactive**: 禁用用户

## 操作指南

### 新用户注册
1. 访问系统登录页面
2. 点击"申请注册"链接
3. 填写个人信息和申请理由
4. 提交申请
5. 等待管理员审批
6. 审批通过后使用员工ID登录

### 创建事件
1. 使用Inputter账户登录
2. 点击"新建事件"
3. 填写事件详细信息
4. 点击"保存草稿"
5. 系统自动提交L1审批

### 审批事件
1. 使用Approver账户登录
2. 在事件列表中查看待审批事件
3. 点击"查看详情"查看完整信息
4. 选择"批准"或"拒绝"
5. 系统更新事件状态

### 管理用户
1. 使用Administrator账户登录
2. 点击"用户管理"
3. 查看待审批申请列表
4. 点击"查看详情"查看申请信息
5. 选择"批准"或"拒绝"
6. 系统自动创建用户账户或更新申请状态

## 注意事项

1. **数据存储**: 当前使用localStorage，数据仅保存在用户浏览器中
2. **权限控制**: 不同角色有不同的操作权限
3. **审批流程**: 事件创建后自动进入审批流程
4. **用户管理**: 只有管理员可以审批用户注册申请
5. **数据导出**: 可通过数据管理功能导出/导入数据